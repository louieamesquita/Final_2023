---
title: "Covid91 vaccine study Final2023"
author: "Loie Amesquita"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
males = filter(FinalData, sex =="M")
females = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
Druggies = filter(FinalData, DrugUser =="yes")
```




# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions



##Method

The project asks us to evaluate the effectiveness of the new Covid921 vaccine through clinical trials. We will also be looking at subgroups that got the placebo and see how that effected the results of the vaccine. There are many variations and effectiveness between different subgroups. Those variations are men, women, LGBTQ, and drug addicts. A full report will be prepared for each group and will include the null and alternative hypothesis and a statistical analysis of the values of p. 
The methods will Have visual analysis using bar charts and numerical review using Pearson's 
chi-square test, Yates for table analysis and Fisher's test to have a complete conclusions within each subgroup. Lastly we will use an efficacy confidence interval formula with coding to calculate vaccine
efficacy in each subgroup. 

## Males

##graph for male

```{r}
dd2 <- males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")


basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

Observing the bar chart is becomes self evident that the males who took the Placebo Got covid 19 at around 67% of them, while those who got the vaccine got infected about 30 % of the time. The graph shows us a huge disparity between the two groups but more analyses is required to come to any sort of  conclusion. 


## Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=males)
rowPerc(table1)
colPerc(table1)
```
The result indicate that those who took the placebo, 69.57% got infected. Meanwhile those who got the vaccine had an infection rate of 30.43%. More results are required to make the conclusion that there is an link between infection rate and treatment. 





##inferentail


```{r}
chisq.test(table1)
chisqtestGC(table1)
malesfish <- fisher.test(table1)
malesfish
```

According to the Chi-squared test, The p-value = 0.0000000000001098, which is a small value. meanwhile the other p-value is 0.00000000000004631. this means that those who got the vaccine 2.24 times higher to get infected compared to those who got the placebo.

## Effectiveness Confidence Interval

```{r}
effect <- malesfish$p.value/(malesfish$p.value +1)
effectivenessmales = malesfish$estimate/(malesfish$estimate +1)*100
print(effectivenessmales)
```
```{r}
low=(malesfish$conf.int[1]/(malesfish$conf.int[1] +1))*100
hi=(malesfish$conf.int[2]/(malesfish$conf.int[2] +1))*100
options(digits=2)
```

The results show that the odds ratio is 69.15. That is a higher ratio of people getting covid 19




## Females

##graph for female
 
 
```{r}
dd2 <- females %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")


basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The results for females are almost similar to the males. The infection rate for females is about 60% for those who took the placebo and about 40% for those who took the vaccine.


## Numerical Results


```{r}
table2 <- xtabs(~infected + treatment, data=females)
rowPerc(table2)
colPerc(table2)
```


As results show 60% of females who took the placebo got infected and 40% of females who got the vaccine got infected. The numbers also show that 98% were infected from those who took the placebo which in groups. this tells us that there is a difference in the vaccine group but more analysis is required.


## Inferential Results


```{r}
chisq.test(table1)
chisqtestGC(table1)
femalesfish <- fisher.test(table1)
femalesfish
```


AS the results show the p-value is 1e-04 which is less than the conventional significance level of .51, we can reject the null hypothesis . Conclude that there is a significant association between the infection status and the treatment the odds ratio is 2.2.


## Efectiveness Confidence Interval


```{r}
effect <- femalesfish$p.value/(femalesfish$p.value +1)
effectivenessfemale = femalesfish$estimate/(femalesfish$estimate +1)*100
print(effectivenessfemale)
```
```{r}
low=(femalesfish$conf.int[1]/(femalesfish$conf.int[1] +1))*100
hi=(femalesfish$conf.int[2]/(femalesfish$conf.int[2] +1))*100
options(digits=2)
```



## LGBTQ



## Druggies


# Overall Results and Conclusions